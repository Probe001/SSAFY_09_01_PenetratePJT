<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
    
<mapper namespace="com.ssafy.group5.model.mapper.RatingMapper">

	<resultMap type="Rating" id="RatingMap">
		<id column="content_id" property="contentId"/>
	</resultMap>

	<select id="selectAll" resultMap="RatingMap">
		select r.content_id, star1, star2, star3, star4, star5
		from rating r left join attraction a on r.content_id = a.content_id
	</select>
	
	<select id="selectBySidoGugun" parameterType="Map" resultMap="RatingMap">
		select r.content_id, star1, star2, star3, star4, star5
		from rating r left join attraction a on r.content_id = a.content_id
		where sido_code=#{sido} and gugun_code=#{gugun}
	</select>
	
	<select id="selectByType" parameterType="int" resultMap="RatingMap">
		select r.content_id, star1, star2, star3, star4, star5
		from rating r join attraction a on r.content_id = a.content_id
		where content_type_id=#{contentTypeId}
	</select>
	
	<select id="selectByStar" parameterType="int" resultMap="RatingMap">
		select r.content_id, star1, star2, star3, star4, star5
		from (select *, (star1*1 + star2*2 + star3*3 + star4*4 + star5*5)/(star1 + star2 + star3 + star4 + star5) rate
			from rating) r
			left join attraction a 
			on r.content_id = a.content_id
		where r.rate >= #{val}
	</select>
	
	<select id="selectById" parameterType="int" resultMap="RatingMap">
		select r.content_id, star1, star2, star3, star4, star5
		from rating r join attraction a on r.content_id = a.content_id
		where r.content_id=#{contentId}
	</select>
	
</mapper>