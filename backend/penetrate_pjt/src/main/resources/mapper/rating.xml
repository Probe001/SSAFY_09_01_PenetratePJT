<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
    
<mapper namespace="com.ssafy.group5.model.mapper.RatingMapper">

	<resultMap type="Rating" id="RatingMap">
		<id column="content_id" property="contentId"/>
		<id column="total_score" property="totalScore"/>
	</resultMap>

	<!-- 관광지 전체 평점 조회 -->	
	<select id="selectAll" resultMap="RatingMap">
		select a.content_id, ifnull(star1, 0) star1, ifnull(star2, 0) star2, ifnull(star3, 0) star3, ifnull(star4, 0) star4, ifnull(star5, 0) star5, ifnull((star1*1 + star2*2 + star3*3 + star4*4 + star5*5)/(star1 + star2 + star3 + star4 + star5), 0.0) total_score
		from rating r right join attraction a on r.content_id = a.content_id
	</select>
	
	<!-- 특정 관광지 평점 조회 -->
	<select id="selectById" parameterType="int" resultMap="RatingMap">
		select r.content_id, star1, star2, star3, star4, star5, (star1*1 + star2*2 + star3*3 + star4*4 + star5*5)/(star1 + star2 + star3 + star4 + star5) total_score
		from rating r join attraction a on r.content_id = a.content_id
		where r.content_id=#{contentId}
	</select>
	
	<!-- 지역별 관광지 평점 조회 -->	
	<select id="selectBySidoGugun" parameterType="Map" resultMap="RatingMap">
		select a.content_id, ifnull(star1, 0) star1, ifnull(star2, 0) star2, ifnull(star3, 0) star3, ifnull(star4, 0) star4, ifnull(star5, 0) star5, ifnull((star1*1 + star2*2 + star3*3 + star4*4 + star5*5)/(star1 + star2 + star3 + star4 + star5), 0.0) total_score
		from rating r right join attraction a on r.content_id = a.content_id
		where sido_code=#{sido} and gugun_code=#{gugun}
	</select>

	<!-- 테마별 관광지 평점 조회 -->	
	<select id="selectByType" parameterType="int" resultMap="RatingMap">
		select a.content_id, ifnull(star1, 0) star1, ifnull(star2, 0) star2, ifnull(star3, 0) star3, ifnull(star4, 0) star4, ifnull(star5, 0) star5, ifnull((star1*1 + star2*2 + star3*3 + star4*4 + star5*5)/(star1 + star2 + star3 + star4 + star5), 0.0) total_score
		from rating r right join attraction a on r.content_id = a.content_id
		where content_type_id=#{contentTypeId}
	</select>

	<!-- val 이상인 평점 조회 -->	
	<select id="selectByStar" parameterType="int" resultMap="RatingMap">
		select r.content_id, star1, star2, star3, star4, star5, total_score
		from (select *, (star1*1 + star2*2 + star3*3 + star4*4 + star5*5)/(star1 + star2 + star3 + star4 + star5) total_score
			from rating) r join attraction a on r.content_id = a.content_id
		where r.total_score >= #{val}
	</select>

	
	
	
</mapper>